# 类图中的多重性(Multiplicity)表示详解

多重性是UML类图中非常重要的概念，它用于精确描述类之间关联的数量关系。在Java类设计中，正确理解和使用多重性可以帮助我们更好地定义类之间的关系。

## 一、多重性的基本概念

多重性(Multiplicity)表示一个类的实例可以与另一个类的多少个实例相关联。它通常出现在关联关系、聚合关系和组合关系的两端。

### 基本语法
```
[下限..上限]
```
或
```
具体数字
```

## 二、常见的多重性表示及含义

| 表示法      | 含义                                                                 | Java代码示例                          |
|-------------|----------------------------------------------------------------------|---------------------------------------|
| `1`         | 有且仅有一个                                                        | `private Student student;`           |
| `0..1`      | 零个或一个（可选）                                                  | `private Student optionalStudent;`   |
| `1..*`      | 一个或多个（至少一个）                                              | `private List<Student> students;`    |
| `0..*` 或 `*` | 零个或多个                                                          | `private Collection<Course> courses;`|
| `n`         | 恰好n个（n为具体数字）                                              | 特定数量的关联                        |
| `m..n`      | 最少m个，最多n个                                                    | 范围限制的关联                        |
| `1..3,7`    | 1到3个，或者7个（不连续的区间）                                     | 复杂关联场景                          |

## 三、多重性在类图中的表示位置

多重性标注在关联关系的两端，靠近对应的类：

```
[类A] —— [多重性] [类B] —— [多重性]
```

例如：
```
Company "1" —— "1..*" Department
```
表示：一个公司有1个或多个部门，一个部门只属于1个公司

## 四、不同类型关系的多重性示例

### 1. 一对一关系 (1:1)

```
User "1" —— "1" Profile
```

Java实现：
```java
class User {
    private Profile profile;
}

class Profile {
    private User user;
}
```

### 2. 一对多关系 (1:N)

```
Teacher "1" —— "1..*" Course
```

Java实现：
```java
class Teacher {
    private List<Course> courses;
}

class Course {
    private Teacher teacher;
}
```

### 3. 多对多关系 (M:N)

```
Student "*" —— "*" Course
```

Java实现：
```java
class Student {
    private Set<Course> courses;
}

class Course {
    private Set<Student> students;
}
```

### 4. 可选关系 (0..1)

```
Person "0..1" —— "1" DrivingLicense
```

Java实现：
```java
class Person {
    private DrivingLicense drivingLicense; // 可能为null
}

class DrivingLicense {
    private Person holder; // 必须有持有人
}
```

## 五、集合类型的多重性映射

| 多重性  | 推荐的Java集合类型           | 示例                                  |
|--------|-----------------------------|---------------------------------------|
| 0..1   | 直接引用（可为null）         | `private Address homeAddress;`       |
| 1      | 直接引用（不可为null）       | `@NonNull private Passport passport;`|
| * 或 0..* | Collection/List/Set        | `private List<Order> orders;`        |
| 1..*   | 非空的Collection/List/Set   | `private Set<Skill> skills = new HashSet<>();` |
| 有序集合 | List                      | `private List<Student> students;`    |
| 唯一集合 | Set                       | `private Set<Email> emailAddresses;` |

## 六、数据库设计中的多重性映射

多重性直接影响数据库表关系设计：

1. **一对一**：
   - 外键放在任意一方
   - 或合并为一张表

2. **一对多**：
   - 外键放在"多"的一方

3. **多对多**：
   - 需要中间关联表

## 七、复杂多重性示例

### 示例1：图书馆系统

```
Library "1" —— "1..*" BookCopy "*" —— "1" Book
```

解释：
- 一个图书馆有1个或多个图书副本
- 一个图书副本对应1本图书(书目)
- 一本图书可能有多个副本在不同图书馆

### 示例2：学校管理系统

```
School "1" —— "1..*" Department "1" —— "5..20" Teacher "*" —— "1..4" Class
```

解释：
- 一个学校有1个或多个部门
- 一个部门有5到20名教师
- 一名教师教授1到4个班级
- 一个班级有多个学生(未展示)

## 八、多重性设计的最佳实践

1. **精确性**：尽可能精确地指定多重性，避免过度使用`*`

2. **合理性检查**：
   - 如果下限为1，确保构造/初始化时建立关联
   - 如果上限较小，考虑使用数组而非集合

3. **文档化**：对非标准的多重性(如3..5)添加注释说明

4. **与业务规则一致**：多重性应反映真实的业务约束

5. **可扩展性**：考虑未来可能的数量变化，避免设置过于严格的上限

## 九、工具中的多重性表示

在常用UML工具中设置多重性：

1. **Visual Paradigm**：右键关联→设置多重性
2. **StarUML**：选择关联线→属性面板修改
3. **PlantUML**：
   ```plantuml
   Class01 "1" *-- "many" Class02
   ```
4. **IntelliJ IDEA**：在类图工具中双击关联线设置

正确使用多重性能使你的类图更加精确和专业，有助于团队沟通和系统设计。在实际项目中，应该结合业务需求仔细考虑每个关联的多重性设置。