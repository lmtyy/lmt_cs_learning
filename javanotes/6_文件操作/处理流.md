# 处理流(Processing Streams)详解

处理流是Java I/O系统中用于对原始数据流进行加工处理的流类，它们不直接连接到数据源或目的地，而是对其他流进行包装，提供额外的功能。

## 1. 处理流的基本概念

处理流（也称为过滤流或包装流）具有以下特点：

1. **不直接连接数据源**：处理流总是包装另一个流（可以是节点流或其他处理流）
2. **提供增强功能**：如缓冲、数据类型转换、对象序列化等
3. **形成流链**：可以多层嵌套，形成处理流水线
4. **统一操作接口**：处理后的流仍然保持基本流接口

## 2. 处理流的主要类型

Java中常见的处理流包括：

### (1) 缓冲流(Buffered Streams)
- `BufferedInputStream`
- `BufferedOutputStream`
- `BufferedReader`
- `BufferedWriter`
- **功能**：提供I/O缓冲，减少物理读写次数

### (2) 数据流(Data Streams)
- `DataInputStream`
- `DataOutputStream`
- **功能**：读写基本Java数据类型(int, double等)

### (3) 对象流(Object Streams)
- `ObjectInputStream`
- `ObjectOutputStream`
- **功能**：对象序列化与反序列化

### (4) 转换流(Conversion Streams)
- `InputStreamReader`
- `OutputStreamWriter`
- **功能**：字节流与字符流之间的桥梁

### (5) 打印流(Print Streams)
- `PrintStream`
- `PrintWriter`
- **功能**：提供方便的打印方法(print/println)

### (6) 其他特殊处理流
- `PushbackInputStream`：支持回退已读取数据
- `LineNumberReader`：带行号计数的Reader
- `SequenceInputStream`：合并多个输入流

## 3. 处理流的工作原理

处理流采用**装饰器模式(Decorator Pattern)**设计：

```
数据源 → 节点流 → 处理流1 → 处理流2 → ... → 程序
```

**典型使用方式**：
```java
// 多层处理流嵌套示例
DataInputStream dis = new DataInputStream(
    new BufferedInputStream(
        new FileInputStream("data.dat")));

// 处理流链：
// FileInputStream(节点流) → BufferedInputStream(缓冲处理) → DataInputStream(数据类型处理)
```

## 4. 处理流的核心优势

1. **功能扩展性**：可以灵活组合不同处理流
2. **代码复用**：通用处理逻辑封装在处理流中
3. **接口一致性**：保持统一的流操作接口
4. **性能优化**：如缓冲流自动优化I/O性能

## 5. 常见处理流详解

### (1) 缓冲流示例

```java
// 使用缓冲流提高文件复制效率
try (BufferedInputStream bis = new BufferedInputStream(
        new FileInputStream("source.jpg"));
     BufferedOutputStream bos = new BufferedOutputStream(
        new FileOutputStream("target.jpg"))) {
    byte[] buffer = new byte[8192];
    int bytesRead;
    while ((bytesRead = bis.read(buffer)) != -1) {
        bos.write(buffer, 0, bytesRead);
    }
}
```

### (2) 数据流示例

```java
// 写入和读取基本数据类型
try (DataOutputStream dos = new DataOutputStream(
        new FileOutputStream("data.bin"))) {
    dos.writeInt(123);
    dos.writeDouble(3.14);
    dos.writeUTF("你好");
}

try (DataInputStream dis = new DataInputStream(
        new FileInputStream("data.bin"))) {
    int i = dis.readInt();
    double d = dis.readDouble();
    String s = dis.readUTF();
}
```

### (3) 对象流示例

```java
// 对象序列化与反序列化
class Person implements Serializable {
    String name;
    int age;
}

// 写入对象
try (ObjectOutputStream oos = new ObjectOutputStream(
        new FileOutputStream("person.dat"))) {
    oos.writeObject(new Person("张三", 25));
}

// 读取对象
try (ObjectInputStream ois = new ObjectInputStream(
        new FileInputStream("person.dat"))) {
    Person p = (Person) ois.readObject();
}
```

## 6. 处理流的使用注意事项

1. **关闭顺序**：应该从外向内关闭流(先关闭最外层的处理流)
   ```java
   // 正确关闭方式
   try (OutputStreamWriter osw = new OutputStreamWriter(
           new FileOutputStream("file.txt"))) {
       // 使用osw
   }
   ```

2. **异常处理**：处理流可能抛出IOException，需要妥善处理

3. **性能考虑**：
   - 避免过度嵌套处理流
   - 注意缓冲流的位置(通常应该是最外层之一)

4. **功能冲突**：某些处理流组合可能导致功能冲突

5. **字符编码**：使用转换流时明确指定字符编码
   ```java
   new InputStreamReader(inputStream, "UTF-8")
   ```

处理流是Java I/O系统的强大功能组件，通过灵活组合不同的处理流，可以构建出高效、功能丰富的数据处理管道。理解处理流的工作原理和适用场景，能够帮助开发者编写更优雅、更高效的I/O代码。