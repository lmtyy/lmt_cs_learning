# Java 标准输入输出流详解

标准输入输出流是 Java 提供的用于控制台输入输出的预定义流对象，它们是 Java I/O 系统的重要组成部分。

## 1. 标准输入输出流概述

Java 提供了三个标准的流对象，定义在 `System` 类中：

1. **System.in** - 标准输入流（InputStream 类型）
2. **System.out** - 标准输出流（PrintStream 类型）
3. **System.err** - 标准错误输出流（PrintStream 类型）

这些流在 Java 程序启动时自动初始化，通常对应于控制台输入输出。

## 2. System.in (标准输入流)

### 基本特性

- 类型：`InputStream`
- 默认关联到键盘输入
- 通常需要包装为更高级的流来方便使用

### 常用包装方式

```java
// 包装为BufferedReader
BufferedReader reader = new BufferedReader(
    new InputStreamReader(System.in));

// 使用Scanner包装(更简单)
Scanner scanner = new Scanner(System.in);
```

### 常用方法

```java
// 读取单个字节
int read() throws IOException
// 使用：
int byteData = System.in.read();  // 阻塞直到输入可用

// 读取到字节数组
int read(byte[] b) throws IOException
// 使用：
byte[] buffer = new byte[1024];
int bytesRead = System.in.read(buffer);

// 读取到字节数组的指定位置
int read(byte[] b, int off, int len) throws IOException
```

### 使用示例

```java
// 使用BufferedReader读取行
try (BufferedReader br = new BufferedReader(
        new InputStreamReader(System.in))) {
    System.out.print("请输入: ");
    String input = br.readLine();
    System.out.println("你输入的是: " + input);
}

// 使用Scanner读取
Scanner scanner = new Scanner(System.in);
System.out.print("请输入数字: ");
int num = scanner.nextInt();
System.out.println("你输入的数字是: " + num);
```

## 3. System.out (标准输出流)

### 基本特性

- 类型：`PrintStream`
- 默认关联到控制台输出
- 提供多种打印方法

### 常用方法

```java
// 打印基本类型
void print(boolean b)
void print(char c)
void print(int i)
void print(long l)
void print(float f)
void print(double d)
void print(char[] s)
void print(String s)
void print(Object obj)

// 打印并换行
void println()  // 仅换行
void println(boolean x)
void println(char x)
void println(int x)
void println(long x)
void println(float x)
void println(double x)
void println(char[] x)
void println(String x)
void println(Object x)

// 格式化输出
PrintStream printf(String format, Object... args)
PrintStream printf(Locale l, String format, Object... args)

// 刷新缓冲区
void flush()
```

### 使用示例

```java
// 基本打印
System.out.print("Hello");  // 不换行
System.out.println(" World");  // 带换行

// 格式化输出
String name = "Alice";
int age = 25;
System.out.printf("姓名: %s, 年龄: %d%n", name, age);

// 打印数组
int[] numbers = {1, 2, 3};
System.out.println(Arrays.toString(numbers));
```

## 4. System.err (标准错误输出流)

### 基本特性

- 类型：`PrintStream`
- 默认也输出到控制台，但通常显示为红色(取决于IDE/终端)
- 用于错误消息和诊断信息

### 常用方法

与 `System.out` 相同，包括 `print()`, `println()`, `printf()` 等

### 使用示例

```java
try {
    // 某些可能失败的操作
} catch (Exception e) {
    System.err.println("发生错误: " + e.getMessage());
    e.printStackTrace(System.err);
}
```

## 5. 重定向标准流

可以重定向标准输入输出流到其他源/目标：

```java
// 重定向标准输出到文件
PrintStream fileOut = new PrintStream("output.txt");
System.setOut(fileOut);  // 之后所有System.out输出到文件

// 重定向标准输入从文件
FileInputStream fileIn = new FileInputStream("input.txt");
System.setIn(fileIn);  // 之后System.in从文件读取

// 恢复原始标准输出(保存原始引用很重要)
PrintStream originalOut = System.out;
System.setOut(originalOut);
```

## 6. 标准流的最佳实践

1. **输入处理**：
   - 优先使用 `Scanner` 或 `BufferedReader` 包装 `System.in`
   - 处理输入时考虑异常情况

2. **输出优化**：
   - 大量输出时考虑使用 `BufferedWriter` 包装
   - 重要信息使用 `System.err` 输出

3. **资源管理**：
   - 重定向后记得恢复或关闭流
   - 使用 try-with-resources 管理资源

4. **性能考虑**：
   - 避免在循环中频繁调用 `System.out.print()`
   - 大量输出时可考虑批量构建字符串后一次输出

## 7. 标准流的高级用法

### 控制台密码输入

```java
Console console = System.console();
if (console != null) {
    char[] password = console.readPassword("输入密码: ");
    // 处理密码
    Arrays.fill(password, ' ');  // 安全清除
} else {
    System.err.println("无法获取控制台实例");
}
```

### 进度指示器

```java
for (int i = 0; i <= 100; i++) {
    System.out.print("\r进度: " + i + "%");  // \r回到行首
    Thread.sleep(100);
}
System.out.println();  // 换行
```

### 颜色输出(ANSI转义码)

```java
// 仅在某些终端支持
System.out.println("\u001B[31m红色文本\u001B[0m");  // 红色
System.out.println("\u001B[32m绿色文本\u001B[0m");  // 绿色
System.out.println("\u001B[34m蓝色文本\u001B[0m");  // 蓝色
```

标准输入输出流是Java程序与控制台交互的基础工具，合理使用可以使程序更加友好和高效。