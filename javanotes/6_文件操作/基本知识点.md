# Java 文件操作详解

Java 提供了多种文件操作方式，主要包括传统的 `java.io` 包和更现代的 `java.nio` 包。下面我将详细介绍 Java 中的文件操作。

## 1. 传统 I/O 文件操作 (`java.io`)

### 1.1 文件读写基础

**文件读取示例 (字节流)**:
```java
try (InputStream in = new FileInputStream("input.txt")) {
    int data;
    while ((data = in.read()) != -1) {
        System.out.print((char) data);
    }
} catch (IOException e) {
    e.printStackTrace();
}
```

**文件写入示例 (字节流)**:
```java
try (OutputStream out = new FileOutputStream("output.txt")) {
    String content = "Hello, World!";
    out.write(content.getBytes());
} catch (IOException e) {
    e.printStackTrace();
}
```

### 1.2 使用缓冲流提高性能

```java
// 缓冲读取
try (BufferedReader reader = new BufferedReader(new FileReader("input.txt"))) {
    String line;
    while ((line = reader.readLine()) != null) {
        System.out.println(line);
    }
}

// 缓冲写入
try (BufferedWriter writer = new BufferedWriter(new FileWriter("output.txt"))) {
    writer.write("Line 1");
    writer.newLine();
    writer.write("Line 2");
}
```

### 1.3 文件操作工具类

`java.io.File` 类提供基本的文件操作:

```java
File file = new File("test.txt");

// 检查文件是否存在
if (file.exists()) {
    System.out.println("文件存在");
    
    // 获取文件信息
    System.out.println("文件名: " + file.getName());
    System.out.println("路径: " + file.getPath());
    System.out.println("绝对路径: " + file.getAbsolutePath());
    System.out.println("大小: " + file.length() + " bytes");
    
    // 删除文件
    if (file.delete()) {
        System.out.println("文件已删除");
    }
} else {
    // 创建新文件
    try {
        if (file.createNewFile()) {
            System.out.println("文件已创建");
        }
    } catch (IOException e) {
        e.printStackTrace();
    }
}
```

## 2. NIO 文件操作 (`java.nio`)

Java NIO (New I/O) 提供了更高效的文件操作方式。

### 2.1 Path 和 Files 类

```java
import java.nio.file.*;

// 获取Path对象
Path path = Paths.get("test.txt");

// 检查文件是否存在
if (Files.exists(path)) {
    System.out.println("文件存在");
    
    // 读取文件属性
    System.out.println("文件名: " + path.getFileName());
    System.out.println("父目录: " + path.getParent());
    System.out.println("绝对路径: " + path.toAbsolutePath());
    System.out.println("大小: " + Files.size(path) + " bytes");
    
    // 删除文件
    Files.delete(path);
    System.out.println("文件已删除");
} else {
    // 创建新文件
    Files.createFile(path);
    System.out.println("文件已创建");
}
```

### 2.2 使用 NIO 读写文件

**读取文件**:
```java
List<String> lines = Files.readAllLines(Paths.get("input.txt"), StandardCharsets.UTF_8);
lines.forEach(System.out::println);
```

**写入文件**:
```java
List<String> content = Arrays.asList("Line 1", "Line 2", "Line 3");
Files.write(Paths.get("output.txt"), content, StandardCharsets.UTF_8);
```

### 2.3 大文件处理

对于大文件，使用缓冲读取:

```java
try (Stream<String> stream = Files.lines(Paths.get("largefile.txt"))) {
    stream.forEach(System.out::println);
} catch (IOException e) {
    e.printStackTrace();
}
```

## 3. 文件操作最佳实践

1. **始终关闭资源**:
   - 使用 try-with-resources 语句确保流正确关闭
   - 适用于所有 `Closeable` 和 `AutoCloseable` 对象

2. **处理字符编码**:
   - 明确指定字符编码 (如 UTF-8)
   - 避免使用平台默认编码

3. **异常处理**:
   - 捕获并适当处理 `IOException`
   - 考虑使用更具体的异常类型 (如 `FileNotFoundException`)

4. **性能考虑**:
   - 对于大文件，使用缓冲流或 NIO
   - 避免一次性读取整个大文件到内存

5. **路径处理**:
   - 使用 `Paths.get()` 和 `Path` 接口代替字符串路径
   - 处理跨平台路径分隔符问题

## 4. 高级文件操作

### 4.1 文件监控 (WatchService)

```java
Path dir = Paths.get("directory_to_watch");
WatchService watchService = FileSystems.getDefault().newWatchService();
dir.register(watchService, 
    StandardWatchEventKinds.ENTRY_CREATE,
    StandardWatchEventKinds.ENTRY_DELETE,
    StandardWatchEventKinds.ENTRY_MODIFY);

while (true) {
    WatchKey key = watchService.take();
    for (WatchEvent<?> event : key.pollEvents()) {
        System.out.println("Event kind: " + event.kind() + ". File affected: " + event.context());
    }
    key.reset();
}
```

### 4.2 随机访问文件

```java
try (RandomAccessFile file = new RandomAccessFile("data.dat", "rw")) {
    // 写入数据
    file.writeInt(123);
    file.writeDouble(123.45);
    file.writeUTF("Hello");
    
    // 移动指针到开头
    file.seek(0);
    
    // 读取数据
    System.out.println(file.readInt());
    System.out.println(file.readDouble());
    System.out.println(file.readUTF());
}
```

### 4.3 文件复制

**NIO 方式 (推荐)**:
```java
Path source = Paths.get("source.txt");
Path target = Paths.get("target.txt");
Files.copy(source, target, StandardCopyOption.REPLACE_EXISTING);
```

**传统 I/O 方式**:
```java
try (InputStream in = new FileInputStream("source.txt");
     OutputStream out = new FileOutputStream("target.txt")) {
    byte[] buffer = new byte[1024];
    int length;
    while ((length = in.read(buffer)) > 0) {
        out.write(buffer, 0, length);
    }
}
```

## 总结

Java 提供了丰富的文件操作 API:
- 对于简单操作，可以使用 `java.io.File` 和传统 I/O 流
- 对于更现代和高效的操作，推荐使用 `java.nio.file` 包
- 大文件处理应考虑使用缓冲或流式处理
- 始终注意资源管理和异常处理

选择哪种方式取决于具体需求，但现代 Java 应用通常推荐使用 NIO API，因为它提供了更强大和灵活的功能。