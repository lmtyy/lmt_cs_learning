---

## 异常处理

---

### 一、什么是异常？

- **异常**是程序运行中发生的错误事件，导致程序正常流程被打断。
- 例如：除数为零、文件不存在、索引越界等都会引发异常。
- **异常处理**机制允许程序捕获异常并做出合理处理，而非直接崩溃。

---

### 二、Python异常体系结构

- 所有异常都是`BaseException`的子类。
- 常用异常基类是`Exception`，大部分程序中捕获的异常都是它的子类。
- 常见异常类别：
  - `ZeroDivisionError`：除数为零异常
  - `IndexError`：索引超出范围
  - `KeyError`：字典键不存在
  - `FileNotFoundError`：文件未找到
  - `ValueError`：值错误
  - `TypeError`：类型错误
  - `IOError`：输入输出错误等

---

### 三、基础的异常处理语法

```python
try:
    # 可能引发异常的代码块
    result = 10 / 0
except ZeroDivisionError:
    # 捕获特定异常后的处理代码
    print("除数不能为零！")
```

程序运行时，如果`try`块内出错就跳转到对应的`except`块继续执行。

---

### 四、完整的异常处理结构

```python
try:
    # 代码块
    pass
except SomeException as e:
    # 处理异常
    pass
else:
    # 没有异常时执行
    pass
finally:
    # 无论是否异常都会执行，常用于清理资源
    pass
```

- **`except`**：捕获异常。
- **`else`**：`try`无异常时执行。
- **`finally`**：总会执行，通常释放资源（文件、网络等）。

---

### 五、捕获多个异常

```python
try:
    num = int(input("请输入数字:"))
    result = 10 / num
except (ValueError, ZeroDivisionError) as e:
    print("输入错误或除数为零：", e)
```

---

### 六、捕获所有异常

```python
try:
    do_something()
except Exception as e:
    print(f"出现异常: {e}")
```

谨慎使用，否则可能掩盖程序bug。

---

### 七、主动抛出异常

使用`raise`语句抛出异常，通常在检测到错误情况时。

```python
def divide(a, b):
    if b == 0:
        raise ValueError("除数不能为零")
    return a / b
```

---

### 八、自定义异常类

```python
class MyError(Exception):
    pass

try:
    raise MyError("自定义错误")
except MyError as e:
    print(e)
```

---

### 九、异常链

捕获异常后重新抛出时，可以保存原始异常信息：

```python
try:
    ...
except SomeError as e:
    raise AnotherError("新的异常") from e
```

---

### 十、示例：打开文件读取并处理异常

```python
try:
    with open("test.txt", "r") as f:
        data = f.read()
except FileNotFoundError:
    print("文件不存在！")
except IOError:
    print("读取文件出错！")
else:
    print("文件内容:", data)
finally:
    print("结束")
```

---

### 十一、小结

| 关键字    | 作用                             |
| --------- | -------------------------------- |
| `try`     | 包含可能抛出异常的代码           |
| `except`  | 捕获异常并处理                   |
| `else`    | 无异常时执行额外代码             |
| `finally` | 无论异常与否都执行，通常清理资源 |
| `raise`   | 主动抛出异常                     |

---

## 