## 结构化文本文件

当然，下面我给你详细介绍一下Python中处理**结构化文本文件CSV（Comma-Separated Values）**的相关知识，包括CSV格式介绍、Python内置的csv模块用法、常见读写操作和一些进阶技巧。

---

### csv

#### 一、什么是CSV文件？

- **CSV格式**是最常用的结构化文本数据存储格式之一，文件中每行表示一条记录，字段之间用逗号`,`分隔（有时也用其他符号如制表符`\t`分隔）。

- 通常用来存储表格型数据，兼容绝大多数电子表格程序（Excel、Google Sheets）和数据库导入导出。

- CSV文件本质是纯文本，易读、易编辑，支持跨平台和多语言。

---

#### 二、csv模块简介

Python内置模块`csv`专门用于读写CSV文件，能正确处理逗号、引号、转义符等问题，避免手动字符串分割的坑。

常用函数：

- `csv.reader`：读取CSV文件并返回迭代器
- `csv.writer`：写入CSV文件
- `csv.DictReader`：将CSV每行作为字典读取，键为表头
- `csv.DictWriter`：以字典形式写入CSV

---

#### 三、基本用法

文件示例`data.csv`：

```csv
name,age,city
Alice,30,New York
Bob,25,Los Angeles
Charlie,35,Chicago
```

---

##### 3.1 读取CSV文件

```python
import csv

with open('data.csv', 'r', encoding='utf-8') as f:
    reader = csv.reader(f)
    header = next(reader)  # 读取表头
    print('Header:', header)
    for row in reader:
        print(row)
```

输出：

```
Header: ['name', 'age', 'city']
['Alice', '30', 'New York']
['Bob', '25', 'Los Angeles']
['Charlie', '35', 'Chicago']
```

---

##### 3.2 读取CSV为字典形式（推荐，方便按列访问）

```python
import csv

with open('data.csv', 'r', encoding='utf-8') as f:
    dict_reader = csv.DictReader(f)
    for row in dict_reader:
        print(row['name'], row['age'], row['city'])
```

输出：

```
Alice 30 New York
Bob 25 Los Angeles
Charlie 35 Chicago
```

---

##### 3.3 写入CSV文件

```python
import csv

header = ['name', 'age', 'city']
rows = [
    ['David', 28, 'Boston'],
    ['Eva', 22, 'Seattle']
]

with open('output.csv', 'w', encoding='utf-8', newline='') as f:
    writer = csv.writer(f)
    writer.writerow(header)  # 写表头
    writer.writerows(rows)    # 写多行数据
```

注意：`open()`时建议使用`newline=''`参数，避免写入时多余空行问题（这是csv模块的推荐做法）。

---

##### 3.4 以字典形式写入CSV

```python
import csv

header = ['name', 'age', 'city']
rows = [
    {'name': 'David', 'age': 28, 'city': 'Boston'},
    {'name': 'Eva', 'age': 22, 'city': 'Seattle'}
]

with open('output_dict.csv', 'w', encoding='utf-8', newline='') as f:
    dict_writer = csv.DictWriter(f, fieldnames=header)
    dict_writer.writeheader()       # 写表头
    dict_writer.writerows(rows)     # 写多行字典数据
```

---

#### 四、csv模块关键参数解释

| 参数             | 说明                                                       |
| ---------------- | ---------------------------------------------------------- |
| delimiter        | 分隔符，默认为`,`，可设为`\t`制表符等                      |
| quotechar        | 引号字符，默认为`"`，当字段包含分隔符时用引号括起来        |
| quoting          | 何时引用字段，常用`csv.QUOTE_MINIMAL`，可设为`QUOTE_ALL`等 |
| skipinitialspace | 跳过分隔符后的空格                                         |
| escapechar       | 转义字符，用于字符串中出现引号等特殊符号                   |
| strict           | 是否严格模式，遇到格式错误抛异常                           |

---

#### 五、进阶使用技巧

##### 5.1 处理带有逗号的字段

字段内容如果含有逗号，需要用引号括起来，csv模块会自动处理。

示例数据：

```csv
name,comment
Alice,"Hello, world"
Bob,"Good, thanks"
```

读取时csv模块自动识别：

```python
for row in csv.reader(f):
    print(row)
# 输出 ['Alice', 'Hello, world']
```

---

##### 5.2 处理其他分隔符

如果使用制表符分隔，可定义`delimiter='\t'`：

```python
csv.reader(f, delimiter='\t')
```

---

##### 5.3 自定义写入格式

- 控制换行符：保证文件跨平台兼容，一般`open()`使用`newline=''`
- 控制编码：多数CSV是UTF-8，但也有可能是GBK等，写入时注意指定

---

##### 5.4 大文件逐行处理

CSV读取器是迭代器，数据量大时不必一次读入内存，适合流式处理。

---

#### 六、示例总结

读取：

```python
import csv

with open('data.csv', 'r', encoding='utf-8') as f:
    reader = csv.DictReader(f)
    for row in reader:
        print(row)
```

写入：

```python
import csv

with open('output.csv', 'w', encoding='utf-8', newline='') as f:
    writer = csv.writer(f)
    writer.writerow(['name', 'age'])
    writer.writerow(['Alice', 30])
    writer.writerow(['Bob', 25])
```

---

#### 七、常见问题

- Windows写CSV出现空行：解决方案是`open()`时添加`newline=''`参数。
- CSV编码问题：读取非UTF-8编码文件时要指定正确编码。
- CSV字段中有逗号、换行需引号包裹，csv模块自动处理，不用手写解析。

---

#### 八、小结

- CSV是轻量级的结构化数据文件标准，广泛用于数据交换。
- Python内置csv模块处理CSV文件简单可靠，支持多种功能。
- 记住常用的`csv.reader` / `csv.writer`及其字典版本`DictReader` / `DictWriter`。
- 注意文件打开方式，编码和换行参数避免常见坑。

---

### Excel

当然详细介绍一下Python中**Excel结构化文本文件**的相关内容，包括Excel的基本概念、Python中处理Excel的常用库、常见操作示例及进阶技巧。

---

#### 一、什么是Excel文件？

- Excel是Microsoft Office套件中的电子表格软件，文件格式主要有：
  - **.xls** —— 早期Excel二进制格式，兼容性好但容量和功能有限
  - **.xlsx** —— Excel 2007及以后版本基于XML的开放格式，功能更强大且文档结构清晰

- Excel文件可以包含多个工作表（Sheet），每个工作表含有行和列的表格数据，可以存储文字、数字、公式、图表等。

- Excel文件是结构化数据存储格式，应用广泛，比如财务报表、数据分析、统计等。

---

#### 二、Python中处理Excel的常用库

Python标准库没有直接支持Excel文件，需要第三方库，常见的有：

| 库名称       | 功能特点                                                   | 支持格式              |
| ------------ | ---------------------------------------------------------- | --------------------- |
| `xlrd`       | 只读旧版Excel格式(.xls及早期.xlsx*)（目前新版不支持.xlsx） | `.xls`（部分`.xlsx`） |
| `xlwt`       | 写旧版Excel格式（.xls）                                    | `.xls`                |
| `openpyxl`   | 读写新版Excel格式（.xlsx），支持表格样式和公式处理         | `.xlsx`               |
| `pandas`     | 高层数据分析库，基于`openpyxl`/`xlrd`等做Excel数据处理     | `.xls`/`.xlsx`        |
| `xlsxwriter` | 只写，功能强大的`.xlsx`生成库，支持图表、格式化            | `.xlsx`               |

> 注：`xlrd`从2.0版本起不再支持`.xlsx`格式，如需读取`.xlsx`请用`openpyxl`。

---

#### 三、使用openpyxl读取和写入Excel

`openpyxl`是目前处理`.xlsx`格式的主力库。

##### 3.1 安装

```bash
pip install openpyxl
```

##### 3.2 读取Excel文件

```python
from openpyxl import load_workbook

# 加载Excel文件
wb = load_workbook('example.xlsx')

# 选择工作表，既可以按名字，也可以按活动表
ws = wb['Sheet1']
# 或 ws = wb.active

# 读取单元格数据
print(ws['A1'].value)  # 读取A1单元格

# 遍历所有行和列
for row in ws.iter_rows(min_row=1, max_col=3, max_row=5):
    for cell in row:
        print(cell.value, end=' ')
    print()
```

---

##### 3.3 写入Excel文件

```python
from openpyxl import Workbook

wb = Workbook()
ws = wb.active
ws.title = "MySheet"

# 写数据
ws['A1'] = '姓名'
ws['B1'] = '年龄'

data = [
    ('Alice', 30),
    ('Bob', 25),
    ('Charlie', 35),
]

for idx, (name, age) in enumerate(data, start=2):
    ws.cell(row=idx, column=1, value=name)
    ws.cell(row=idx, column=2, value=age)

# 保存文件
wb.save('output.xlsx')
```

---

#### 四、使用pandas操作Excel文件

`pandas`封装了Excel读写接口，用法更侧重于数据分析。

##### 4.1 安装

```bash
pip install pandas openpyxl xlrd
```

##### 4.2 读取Excel为DataFrame

```python
import pandas as pd

# 读取Excel中第一个或者指定工作表
df = pd.read_excel('example.xlsx', sheet_name='Sheet1')

print(df.head())
```

##### 4.3 写入DataFrame到Excel

```python
df = pd.DataFrame({
    'Name': ['Alice', 'Bob', 'Charlie'],
    'Age': [30, 25, 35]
})

df.to_excel('output.xlsx', sheet_name='People', index=False)
```

---

#### 五、Excel文件操作常见技巧

- **读取多个工作表**

```python
dfs = pd.read_excel('example.xlsx', sheet_name=None)  # 返回字典，键为sheet名，值为DataFrame
for name, data in dfs.items():
    print(f"Sheet: {name}")
    print(data.head())
```

- **追加写入**

Excel不支持直接追加写入单独行，常用方法为：

1. 读取已有数据为DataFrame  
2. 追加数据  
3. 重新写回Excel文件

- **格式化单元格**

`openpyxl`支持设置字体、颜色、边框、对齐等：

```python
from openpyxl.styles import Font

cell = ws['A1']
cell.font = Font(name='Calibri', size=14, bold=True, color='FF0000')
```

- **处理公式**

写入单元格可以直接写公式：

```python
ws['C1'] = '=SUM(B2:B4)'
wb.save('output.xlsx')
```

---

#### 六、其它相关库简介

- **xlwt**：只能写`.xls`格式，不支持`.xlsx`，适合兼容旧系统
- **xlrd**：用于读取`.xls`，新版无法读取`.xlsx`
- **xlsxwriter**：功能强大的写`.xlsx`库，支持图表等高级功能，但只能写不能读

---

#### 七、总结表

| 操作需求           | 推荐库                       | 支持格式        | 功能特点                         |
| ------------------ | ---------------------------- | --------------- | -------------------------------- |
| 读取 `.xlsx`       | openpyxl, pandas             | `.xlsx`         | 读取工作表，访问单元格，样式支持 |
| 写入 `.xlsx`       | openpyxl, pandas, xlsxwriter | `.xlsx`         | 样式、公式、图表支持             |
| 读取 `.xls`        | xlrd, pandas                 | `.xls`          | 早期Excel格式                    |
| 写入 `.xls`        | xlwt                         | `.xls`          | 兼容旧Excel格式                  |
| 数据分析和批量处理 | pandas                       | `.xls`, `.xlsx` | 高层数据结构支持，方便转换和统计 |

---

#### 八、示例代码汇总

**读取`xlsx`文件第一张表并遍历打印所有数据（openpyxl）**

```python
from openpyxl import load_workbook

wb = load_workbook('example.xlsx')
ws = wb.active

for row in ws.iter_rows(values_only=True):
    print(row)
```

**使用pandas读取Excel文件全部工作表**

```python
import pandas as pd

dfs = pd.read_excel('example.xlsx', sheet_name=None)
for sheet_name, df in dfs.items():
    print(f'Sheet Name: {sheet_name}')
    print(df.head())
```

---

#### 九、参考资料

- [openpyxl官方文档](https://openpyxl.readthedocs.io/en/stable/)
- [pandas官方文档 - Excel IO](https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.read_excel.html)

---

### PDF

详细介绍一下Python中非常流行的PDF处理库——**PyPDF2**，包括它的功能、安装、主要用法示例以及一些进阶技巧。

---

#### 一、什么是 PyPDF2？

- `PyPDF2` 是一个纯Python编写的库，用于**阅读、操作和写入 PDF 文件**。
- 它支持：合并PDF、拆分页面、加密解密、旋转页面、提取文本和元数据等功能。
- 适合需要自动化PDF处理的Python开发者和数据分析师。

---

#### 二、安装方法

```bash
pip install PyPDF2
```

> 注意：旧版本有时写作`pypdf2`，当前推荐使用`PyPDF2`（最新维护的库），从2022年起，PyPDF2已迁移到`pypdf`项目，接口基本兼容。

---

#### 三、PyPDF2主要功能和类

- **PdfReader**：读取PDF文件，访问文件内容、页面、元数据、文本等。
- **PdfWriter**：创建和写入PDF文件，支持添加页面、合并、加密等。
- **PageObject**：代表PDF中的单页，支持旋转、裁剪、合并页面内容操作。
- **常用功能**：
  - 读取PDF并提取文本
  - 合并多个PDF文件
  - 拆分PDF（提取指定页）
  - 旋转页面
  - 给PDF加密或解密
  - 修改PDF元数据

---

#### 四、基础示例

---

##### 4.1 读取PDF并获取页数

```python
from PyPDF2 import PdfReader

reader = PdfReader('example.pdf')
print(f'页数: {len(reader.pages)}')
```

---

##### 4.2 提取文本（示例提取第一页）

```python
page = reader.pages[0]
text = page.extract_text()
print(text)
```

---

##### 4.3 合并两个PDF文件

```python
from PyPDF2 import PdfReader, PdfWriter

pdf_writer = PdfWriter()

for pdf_file in ['doc1.pdf', 'doc2.pdf']:
    reader = PdfReader(pdf_file)
    for page in reader.pages:
        pdf_writer.add_page(page)

with open('merged.pdf', 'wb') as f_out:
    pdf_writer.write(f_out)
```

---

##### 4.4 拆分PDF，提取部分页面

```python
from PyPDF2 import PdfReader, PdfWriter

reader = PdfReader('example.pdf')
writer = PdfWriter()

# 提取第2页和第3页（索引从0开始）
for i in [1, 2]:
    writer.add_page(reader.pages[i])

with open('split.pdf', 'wb') as f_out:
    writer.write(f_out)
```

---

##### 4.5 旋转PDF页面

```python
page = reader.pages[0]
page.rotate(90)  # 顺时针旋转90度

writer = PdfWriter()
writer.add_page(page)

with open('rotated.pdf', 'wb') as f_out:
    writer.write(f_out)
```

---

##### 4.6 给PDF文件加密

```python
reader = PdfReader('example.pdf')
writer = PdfWriter()

for page in reader.pages:
    writer.add_page(page)

writer.encrypt(user_password='userpass', owner_password='ownerpass', use_128bit=True)

with open('encrypted.pdf', 'wb') as f_out:
    writer.write(f_out)
```

打开时需要输入密码`userpass`。

---

##### 4.7 解密PDF文件

```python
reader = PdfReader('encrypted.pdf')
if reader.is_encrypted:
    reader.decrypt('userpass')
    text = reader.pages[0].extract_text()
    print(text)
```

---

#### 五、PyPDF2的注意点及限制

- **文本提取**功能较为基础，对复杂布局和格式支持有限，无法提取图片或表格。
- 不支持创建PDF内容，如添加文字、绘图等，只能操作已有PDF。
- 加密解密支持有限，只能处理常见的用户密码保护。
- 对PDF格式的内部复杂结构理解有限，有一些PDF文件无法正确处理。

---

#### 六、常用API总结

| 功能         | 类/方法                          | 说明                      |
| ------------ | -------------------------------- | ------------------------- |
| 打开PDF      | `PdfReader(file)`                | 读取PDF文件               |
| 获取页数     | `len(reader.pages)`              | PDF页面总数               |
| 获取页面对象 | `reader.pages[index]`            | 返回第`index`页PageObject |
| 提取文本     | `page.extract_text()`            | 提取页面文本              |
| 新建PDF文档  | `PdfWriter()`                    | 创建空的写入器            |
| 添加页面     | `writer.add_page(page)`          | 添加页面到写入PDF         |
| 写入文件     | `writer.write(file_obj)`         | 写入PDF到文件             |
| 旋转页面     | `page.rotate(clockwise_degrees)` | 页面对页旋转              |
| 加密         | `writer.encrypt(password)`       | 给PDF加密                 |
| 解密         | `reader.decrypt(password)`       | 解密PDF                   |

---

#### 七、简单示例整合

```python
from PyPDF2 import PdfReader, PdfWriter

# 1. 读取PDF
reader = PdfReader('input.pdf')

# 2. 创建写入对象
writer = PdfWriter()

# 3. 复制并旋转第一页
page = reader.pages[0]
page.rotate(90)
writer.add_page(page)

# 4. 添加剩余页面
for i in range(1, len(reader.pages)):
    writer.add_page(reader.pages[i])

# 5. 保存新PDF文件
with open('output.pdf', 'wb') as f_out:
    writer.write(f_out)
```

---

#### 八、总结

- PyPDF2是Python中优秀且免费的PDF处理工具，适合自动化文档处理。
- 主要用于合并、拆分、旋转、加密和文本提取。
- 不支持内容创建和复杂格式处理。
- 对于复杂PDF操作，可能需要结合其他库（如`pdfplumber`做高级文本提取，`reportlab`做PDF生成）。

---

## 