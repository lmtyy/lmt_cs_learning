## 文本文件读写

好的，下面我详细讲解一下Python中**文本文件的读写**相关内容，包括打开文件、读写操作、文件关闭以及常见注意事项和示例。

---

### 一、文件打开

Python内置函数`open()`用于打开文件，格式如下：

```python
open(file, mode='r', encoding=None)
```

- `file`：文件路径（相对或绝对）
- `mode`：打开模式，默认为只读文本模式 `'r'`
- `encoding`：文本文件的编码方式，常用`'utf-8'`，默认为平台默认编码

---

### 二、打开模式

| 模式   | 说明                         | 读/写    | 文件不存在处理   |
| ------ | ---------------------------- | -------- | ---------------- |
| `'r'`  | 只读（默认），文件必须存在   | 读取     | 文件不存在报错   |
| `'w'`  | 写入，文件存在则覆盖         | 写入     | 文件不存在则创建 |
| `'a'`  | 追加写入，文件指针在文件末尾 | 写入追加 | 文件不存在则创建 |
| `'x'`  | 独占写入，不允许覆盖已有文件 | 写入     | 文件已存在则报错 |
| `'r+'` | 读写模式，文件必须存在       | 读写     | 文件不存在报错   |
| `'w+'` | 读写模式，覆盖写入           | 读写     | 文件不存在则创建 |
| `'a+'` | 读写模式，追加写入           | 读写追加 | 文件不存在则创建 |

---

### 三、文本文件读操作

1. **读取整个文件内容**

```python
with open('file.txt', 'r', encoding='utf-8') as f:
    content = f.read()
print(content)
```

2. **按行读取**

- 使用`readline()`读取一行，调用多次读取多行：

```python
with open('file.txt', 'r', encoding='utf-8') as f:
    line = f.readline()
    while line:
        print(line, end='')
        line = f.readline()
```

- 使用`readlines()`一次性读取所有行，返回列表：

```python
with open('file.txt', 'r', encoding='utf-8') as f:
    lines = f.readlines()
print(lines)  # 每行为列表一个元素
```

- 直接遍历文件对象，逐行处理（推荐）：

```python
with open('file.txt', 'r', encoding='utf-8') as f:
    for line in f:
        print(line, end='')
```

---

### 四、文本文件写操作

- 打开模式为`'w'`（覆盖写）或`'a'`（追加写）

```python
with open('file.txt', 'w', encoding='utf-8') as f:
    f.write('第一行文本\n')
    f.write('第二行文本\n')
```

- 追加写入（保留原有内容，在末尾添加）：

```python
with open('file.txt', 'a', encoding='utf-8') as f:
    f.write('追加的文本\n')
```

- 写入多行：

```python
lines = ['第一行\n', '第二行\n', '第三行\n']
with open('file.txt', 'w', encoding='utf-8') as f:
    f.writelines(lines)
```

注意：`writelines()`不会自动添加换行符，需要在字符串中显式包含`\n`。

---

### 五、文件关闭

- 使用`with open(...) as f:` 形式打开文件，Python会自动关闭文件，推荐方式。

- 也可以使用传统打开关闭：

```python
f = open('file.txt', 'r')
data = f.read()
f.close()
```

缺点：如果程序异常，文件可能未被关闭。

---

### 六、编码问题

- 文本文件涉及编码，建议打开时显式声明编码，防止跨平台乱码。
- 常用编码：`utf-8`，`gbk`（Windows中文环境）

---

### 七、常用示例

1. **读取文本文件并打印**

```python
with open('example.txt', 'r', encoding='utf-8') as f:
    for line in f:
        print(line.strip())  # strip去除换行符和两边空白
```

2. **写文本文件**

```python
text = ['Hello world\n', 'Python文件读写示例\n']
with open('example_write.txt', 'w', encoding='utf-8') as f:
    f.writelines(text)
```

3. **读写组合**

```python
with open('input.txt', 'r', encoding='utf-8') as fin, \
     open('output.txt', 'w', encoding='utf-8') as fout:
    for line in fin:
        fout.write(line.upper())
```

---

### 八、常见问题

- **写入字符串必须是str类型，不能直接写int，需要先转换为str。**

```python
f.write(str(123))
```

- **不能将二进制文件用文本模式打开，需用`'rb'`或`'wb'`等二进制模式。**

- **文件路径要注意相对路径和绝对路径，根据工作目录不同会导致找不到文件。**

---

### 九、总结

| 动作       | 方法                     | 说明                             |
| ---------- | ------------------------ | -------------------------------- |
| 读取全部   | `f.read()`               | 读取整个文件内容                 |
| 读取一行   | `f.readline()`           | 每次读取一行                     |
| 读取所有行 | `f.readlines()`          | 读取全部行，返回列表             |
| 迭代行     | `for line in f`          | 逐行遍历文件                     |
| 写入字符串 | `f.write(string)`        | 写入字符串                       |
| 写入多行   | `f.writelines(list)`     | 一次写入多行（注意换行符）       |
| 关闭文件   | `f.close()` / `with`语法 | 保证文件句柄释放，建议使用`with` |

---

好的！下面我来详细介绍一下Python中的**上下文管理器（Context Manager）**，这是一种非常重要且实用的机制，帮助我们优雅地管理资源（如文件、网络连接、锁等）的获取和释放。

---

## 