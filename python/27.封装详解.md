---

## 封装详解

---

### 一、什么是封装？

封装是面向对象编程（OOP）的核心原则之一，指将数据（属性）和操作数据的方法（函数）绑定在一起，**隐藏对象的内部实现细节**，只暴露必要的接口供外部访问和操作。

通俗来说，封装让对象的内部状态对外部是“隐藏”的，保护数据不被外部随意修改，提高安全性和代码的可维护性。

---

### 二、Python中的封装实现方式

Python不像Java或C++有严格的访问修饰符`private`、`protected`、`public`，而是通过**命名约定和魔术方法**实现封装。

| 访问权限类型 | 标识符命名       | 访问权限说明                               |
| ------------ | ---------------- | ------------------------------------------ |
| 公开成员     | 直接命名         | 可被外部直接访问和修改                     |
| 受保护成员   | 单下划线`_`开头  | 建议内部使用，外部可访问但不推荐操作       |
| 私有成员     | 双下划线`__`开头 | 名称重整，不可直接外部访问，实现伪私有机制 |

---

### 三、示例与说明

```python
class Person:
    def __init__(self, name, age):
        self.name = name       # 公开属性
        self._gender = "未知"   # 受保护属性（约定俗成）
        self.__age = age        # 私有属性（名称重整）

    def get_age(self):
        return self.__age

    def set_age(self, age):
        if 0 < age < 120:
            self.__age = age
        else:
            print("非法年龄")

p = Person("Alice", 30)

print(p.name)        # 公开属性，正常访问
print(p._gender)     # 受保护属性，虽然能访问，但不建议外部使用

# print(p.__age)     # 报错，私有属性不可直接访问

print(p.get_age())   # 通过公开方法访问私有属性
p.set_age(35)
print(p.get_age())
```

**说明：**

- 双下划线`__age`在内部会被重命名为`_Person__age`，使用`p._Person__age`也能访问，但不建议这样做。
- 使用**getter/setter方法**（访问器和修改器）来控制属性访问是常见封装方式。

---

### 四、属性封装的另一种方式：使用`property`

Python提供了**`property`函数和`@property`装饰器**，让你可以像访问属性一样访问方法，实现更优雅的封装。

```python
class Person:
    def __init__(self, age):
        self._age = age   # 受保护变量

    @property
    def age(self):
        return self._age  # 访问器getter

    @age.setter
    def age(self, value):
        if 0 < value < 120:
            self._age = value
        else:
            raise ValueError("非法年龄")

p = Person(30)
print(p.age)    # 调用getter
p.age = 35      # 调用setter
print(p.age)
# p.age = -5    # 触发异常
```

---

### 五、封装带来的好处

1. **数据保护**：防止对象的状态被非法修改或破坏。
2. **接口简化**：隐藏内部复杂实现，仅暴露必要操作，提高代码接口清晰度。
3. **可维护性强**：实现细节改变不影响使用者，只要接口不变。
4. **实现控制**：可以控制对属性访问，比如添加权限验证和逻辑校验。

---

### 六、私有成员与名称重整

直接访问私有属性会失败：

```python
print(p.__age)  # AttributeError
```

这是因为Python在后台对双下划线开头的属性进行了名称重整：

属性名`__age`被改写为`_Person__age`，确保外部无法轻易访问。

```python
print(p._Person__age)  # 30，强制访问，但不建议
```

---

### 七、封装总结

| 封装方式          | 实现手段                      | 说明                                 |
| ----------------- | ----------------------------- | ------------------------------------ |
| 公开成员          | 直接命名                      | 可自由访问                           |
| 受保护成员        | `_single_underscore`          | 约定内部使用，外部可访问但应避免使用 |
| 私有成员          | `__double_underscore`         | 名称重整，伪“私有”，防止外部访问     |
| 通过getter/setter | 使用普通方法或@property装饰器 | 优雅封装，实现访问控制和数据校验     |