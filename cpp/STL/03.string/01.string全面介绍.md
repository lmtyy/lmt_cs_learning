好的，我们来全面讲解 C++ STL 中的 `string`，所有代码示例都基于已经包含 `using namespace std`。

## 1. string 的基本概念

`string` 是 C++ 标准库中用于处理字符串的类，它封装了字符序列并提供了丰富的操作方法。

```cpp
// 基本定义和使用
string s1;              // 空字符串
string s2 = "Hello";    // 直接初始化
string s3("World");     // 构造函数初始化
```

## 2. 构造函数和初始化

```cpp
#include <iostream>
using namespace std;

int main() {
    // 各种初始化方式
    string s1;                    // 空字符串
    string s2("Hello World");     // 从C风格字符串初始化
    string s3 = "C++ String";     // 赋值初始化
    string s4(s2);                // 拷贝构造
    string s5(5, 'A');            // 5个'A'，结果："AAAAA"
    string s6(s2, 6, 5);          // 从s2的第6个字符开始，取5个字符，结果："World"
    string s7(s2, 6);             // 从s2的第6个字符开始到结尾，结果："World"
    
    cout << "s1: " << s1 << endl;
    cout << "s2: " << s2 << endl;
    cout << "s3: " << s3 << endl;
    cout << "s4: " << s4 << endl;
    cout << "s5: " << s5 << endl;
    cout << "s6: " << s6 << endl;
    cout << "s7: " << s7 << endl;
    
    return 0;
}
```

## 3. 基本操作和运算符重载

```cpp
// 赋值操作
string str1 = "Hello";
string str2;
str2 = str1;            // 字符串赋值
str2 = "World";         // C字符串赋值
str2 = 'A';             // 字符赋值

// 连接操作
string result = str1 + " " + str2;  // "Hello World"
str1 += " C++";                     // str1变为"Hello C++"

// 比较操作
string a = "apple";
string b = "banana";
if (a == b) cout << "Equal" << endl;
if (a < b)  cout << "a < b" << endl;     // 字典序比较
if (a != "orange") cout << "Not orange" << endl;

// 索引访问
string text = "Hello";
cout << text[0];        // 输出'H'
cout << text.at(1);     // 输出'e'
text[0] = 'h';          // 修改为"hello"
```

## 4. 容量相关函数

```cpp
string str = "Hello";

cout << "长度: " << str.length() << endl;        // 5
cout << "大小: " << str.size() << endl;          // 5
cout << "容量: " << str.capacity() << endl;      // 当前分配的内存大小
cout << "是否为空: " << str.empty() << endl;     // 0(false)

str.reserve(100);       // 预留100字符的空间
cout << "预留后容量: " << str.capacity() << endl;

str.shrink_to_fit();    // 收缩到合适大小
cout << "收缩后容量: " << str.capacity() << endl;
```

## 5. 元素访问函数

```cpp
string str = "Hello World";

// 各种访问方式
cout << "第一个字符: " << str.front() << endl;    // H
cout << "最后一个字符: " << str.back() << endl;   // d
cout << "第6个字符: " << str[5] << endl;          // 空格
cout << "第7个字符: " << str.at(6) << endl;       // W

// 获取C风格字符串指针
const char* cstr = str.c_str();
cout << "C风格字符串: " << cstr << endl;

// 获取底层字符数组指针（C++17）
string data_str = "Test";
char* data_ptr = data_str.data();  // 可修改的指针
data_ptr[0] = 't';                 // 修改为"test"
```

## 6. 修改字符串内容

```cpp
string str = "I like programming";

// 追加内容
str.append(" in C++");              // "I like programming in C++"
str.push_back('!');                 // 追加单个字符
str.insert(7, "really ");           // 在位置7插入，"I like really programming in C++!"

// 删除内容
str.erase(7, 7);                    // 从位置7开始删除7个字符
str.pop_back();                     // 删除最后一个字符

// 替换内容
str.replace(2, 4, "love");          // 从位置2开始，替换4个字符为"love"

// 交换字符串
string other = "Another string";
str.swap(other);

// 清空字符串
str.clear();
```

## 7. 字符串查找操作

```cpp
string text = "Hello World, Welcome to C++ World";

// 查找子串
size_t pos = text.find("World");           // 查找第一次出现位置
cout << "World第一次出现在: " << pos << endl;  // 6

pos = text.find("World", 10);              // 从位置10开始查找
cout << "从位置10开始查找: " << pos << endl;   // 25

// 反向查找
pos = text.rfind("World");                 // 从后往前找
cout << "World最后一次出现在: " << pos << endl; // 25

// 查找字符集合
pos = text.find_first_of("aeiou");         // 查找第一个元音字母
cout << "第一个元音在: " << pos << endl;       // 1('e')

pos = text.find_last_of(" ,");             // 查找最后一个空格或逗号
cout << "最后一个空格或逗号在: " << pos << endl;

// 查找不在集合中的字符
pos = text.find_first_not_of("Helo ");     // 查找第一个不是H,e,l,o,空格的字符
cout << "第一个不同字符在: " << pos << endl;   // 6('W')
```

## 8. 子串操作

```cpp
string text = "Hello World";

// 提取子串
string sub1 = text.substr(6);          // 从位置6到结尾，"World"
string sub2 = text.substr(0, 5);       // 从位置0开始，取5个字符，"Hello"
string sub3 = text.substr(6, 5);       // 从位置6开始，取5个字符，"World"

cout << "sub1: " << sub1 << endl;
cout << "sub2: " << sub2 << endl;
cout << "sub3: " << sub3 << endl;

// 子串的常见用法：提取文件名、扩展名等
string filepath = "/home/user/document.txt";
size_t last_slash = filepath.find_last_of('/');
size_t last_dot = filepath.find_last_of('.');

if (last_slash != string::npos) {
    string filename = filepath.substr(last_slash + 1);
    cout << "文件名: " << filename << endl;  // "document.txt"
}

if (last_dot != string::npos) {
    string extension = filepath.substr(last_dot);
    cout << "扩展名: " << extension << endl; // ".txt"
}
```

## 9. 字符串比较

```cpp
string str1 = "apple";
string str2 = "banana";
string str3 = "apple";

// 比较操作
if (str1 == str3) cout << "str1等于str3" << endl;
if (str1 != str2) cout << "str1不等于str2" << endl;
if (str1 < str2)  cout << "str1小于str2" << endl;
if (str2 > str1)  cout << "str2大于str1" << endl;

// 使用compare函数进行更精细的比较
int result = str1.compare(str2);
if (result == 0) {
    cout << "字符串相等" << endl;
} else if (result < 0) {
    cout << "str1小于str2" << endl;
} else {
    cout << "str1大于str2" << endl;
}

// 比较子串
result = str1.compare(0, 2, "ap");  // 比较str1的前2个字符和"ap"
```

## 10. 数值转换（C++11起）

```cpp
// 字符串转数值
string num_str = "123";
int num_int = stoi(num_str);          // 转int
double num_double = stod("3.14159");  // 转double
long num_long = stol("1000000");      // 转long

cout << "整数: " << num_int << endl;
cout << "浮点数: " << num_double << endl;
cout << "长整数: " << num_long << endl;

// 数值转字符串
string str_int = to_string(42);           // "42"
string str_double = to_string(3.14);      // "3.140000"
string str_bool = to_string(true);        // "1"

cout << "整数转字符串: " << str_int << endl;
cout << "浮点数转字符串: " << str_double << endl;
```

## 11. 迭代器操作

```cpp
string str = "Hello C++";

// 使用迭代器遍历
cout << "正向遍历: ";
for (auto it = str.begin(); it != str.end(); ++it) {
    cout << *it;
}
cout << endl;

// 反向迭代器
cout << "反向遍历: ";
for (auto rit = str.rbegin(); rit != str.rend(); ++rit) {
    cout << *rit;
}
cout << endl;

// 基于范围的for循环（C++11）
cout << "范围for循环: ";
for (char c : str) {
    cout << c;
}
cout << endl;

// 使用算法
#include <algorithm>
reverse(str.begin(), str.end());
cout << "反转后: " << str << endl;
```

## 12. 综合示例

```cpp
// 一个完整的字符串处理示例
void processString() {
    string text = "   Hello, World! This is a test string.   ";
    
    // 去除首尾空格
    size_t start = text.find_first_not_of(" ");
    size_t end = text.find_last_not_of(" ");
    string trimmed = text.substr(start, end - start + 1);
    
    cout << "原始: '" << text << "'" << endl;
    cout << "去除空格: '" << trimmed << "'" << endl;
    
    // 转换为大写
    for (char& c : trimmed) {
        c = toupper(c);
    }
    cout << "大写: " << trimmed << endl;
    
    // 统计单词数量
    int word_count = 0;
    bool in_word = false;
    for (char c : trimmed) {
        if (isalpha(c)) {
            if (!in_word) {
                word_count++;
                in_word = true;
            }
        } else {
            in_word = false;
        }
    }
    cout << "单词数量: " << word_count << endl;
    
    // 分割字符串
    string data = "apple,banana,orange,grape";
    size_t pos = 0;
    cout << "分割结果: ";
    while ((pos = data.find(',')) != string::npos) {
        string token = data.substr(0, pos);
        cout << token << " ";
        data.erase(0, pos + 1);
    }
    cout << data << endl;  // 最后一个元素
}

int main() {
    processString();
    return 0;
}
```

## 13. 重要注意事项

1. **npos的使用**：
```cpp
string str = "Hello";
if (str.find("x") == string::npos) {
    cout << "未找到子串" << endl;
}
```

2. **字符串连接顺序**：
```cpp
// 正确
string s1 = string("Hello") + " " + "World";

// 错误：不能直接连接两个C风格字符串
// string s2 = "Hello" + " " + "World"; // 编译错误
```

3. **性能考虑**：
```cpp
// 低效：多次重新分配内存
string result;
for (int i = 0; i < 1000; i++) {
    result += "a";  // 可能多次重新分配
}

// 高效：预先分配空间
string result2;
result2.reserve(1000);  // 预先分配
for (int i = 0; i < 1000; i++) {
    result2 += "a";     // 不会重新分配
}
```

string 类是 C++ 中最常用和最重要的类之一，熟练掌握它的各种用法对于编写高质量的 C++ 程序至关重要。