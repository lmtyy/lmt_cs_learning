å¥½ ğŸ‘ï¼Œæˆ‘ä»¬æ¥è®²ä¸€ä¸‹ **C++ ä¸­è¿ç®—ç¬¦é‡è½½**é‡Œå¸¸è§çš„ä¸¤ä¸ªï¼š

- `operator[]` â€”â€” ä¸‹æ ‡è¿ç®—ç¬¦é‡è½½
- `operator=` â€”â€” èµ‹å€¼è¿ç®—ç¬¦é‡è½½

å®ƒä»¬ä¸€ä¸ªç”¨äºå®¹å™¨ç±»çš„è®¿é—®ï¼Œå¦ä¸€ä¸ªç”¨äºå¯¹è±¡çš„èµ‹å€¼ã€‚

------

## 1. `operator[]` â€”â€” ä¸‹æ ‡è¿ç®—ç¬¦é‡è½½

### åŸºæœ¬è¯­æ³•

```cpp
T& operator[](size_t index);
const T& operator[](size_t index) const;
```

- è¿”å› **å¼•ç”¨**ï¼Œè¿™æ ·æ—¢èƒ½è¯»åˆèƒ½å†™ã€‚
- å»ºè®®åŒæ—¶æä¾› `const` ç‰ˆæœ¬ï¼ˆç”¨äºå¸¸é‡å¯¹è±¡ï¼‰ã€‚

### ç¤ºä¾‹ï¼šå°è£…åŠ¨æ€æ•°ç»„

```cpp
#include <iostream>
using namespace std;

class MyArray {
private:
    int* data;
    size_t size;
public:
    MyArray(size_t n) : size(n) {
        data = new int[n]();
    }
    ~MyArray() { delete[] data; }

    // ä¸‹æ ‡è¿ç®—ç¬¦
    int& operator[](size_t i) {
        return data[i];
    }
    const int& operator[](size_t i) const {
        return data[i];
    }

    size_t getSize() const { return size; }
};

int main() {
    MyArray arr(5);
    arr[0] = 42;             // å†™å…¥
    cout << arr[0] << endl;  // è¯»å–

    const MyArray cArr(3);
    // cArr[0] = 5;  // âŒ ä¸å…è®¸ä¿®æ”¹
    cout << cArr[0] << endl; // OKï¼šåªè¯»
}
```

ğŸ‘‰ **è¦ç‚¹**ï¼š

- è¿”å›å¼•ç”¨ï¼ˆ`int&`ï¼‰ï¼Œå¦åˆ™ `arr[0] = 42;` æ— æ³•ç”Ÿæ•ˆã€‚
- å¸¸é‡å¯¹è±¡è¦ç”¨ `const` ç‰ˆæœ¬ã€‚
- ä¸€èˆ¬è¦åŠ è¶Šç•Œæ£€æŸ¥ï¼ˆå¯ä»¥ç”¨ `at()` æˆ–æ–­è¨€ï¼‰ã€‚

------

## 2. `operator=` â€”â€” èµ‹å€¼è¿ç®—ç¬¦é‡è½½

### èƒŒæ™¯

- ç¼–è¯‘å™¨ä¼šé»˜è®¤ç”Ÿæˆä¸€ä¸ª `operator=`ï¼ˆ**æµ…æ‹·è´**ï¼‰ã€‚
- å¦‚æœç±»é‡Œæœ‰ **æŒ‡é’ˆæˆ–èµ„æºç®¡ç†**ï¼Œå¿…é¡»è‡ªå·±å†™ï¼Œé¿å…æµ…æ‹·è´å¼•å‘çš„ **åŒé‡é‡Šæ”¾ (double free)** é—®é¢˜ã€‚

### åŸºæœ¬è¯­æ³•

```cpp
T& operator=(const T& rhs) {
    if (this != &rhs) {
        // 1. é‡Šæ”¾å·²æœ‰èµ„æº
        // 2. åˆ†é…æ–°èµ„æºå¹¶æ‹·è´ rhs çš„å†…å®¹
    }
    return *this;
}
```

### ç¤ºä¾‹ï¼šæ·±æ‹·è´å®ç°

```cpp
#include <iostream>
#include <cstring>
using namespace std;

class MyString {
private:
    char* data;
public:
    MyString(const char* s = "") {
        data = new char[strlen(s) + 1];
        strcpy(data, s);
    }

    ~MyString() { delete[] data; }

    // æ‹·è´æ„é€ 
    MyString(const MyString& other) {
        data = new char[strlen(other.data) + 1];
        strcpy(data, other.data);
    }

    // èµ‹å€¼è¿ç®—ç¬¦
    MyString& operator=(const MyString& other) {
        if (this != &other) {              // é¿å…è‡ªèµ‹å€¼
            delete[] data;                 // é‡Šæ”¾æ—§èµ„æº
            data = new char[strlen(other.data) + 1];
            strcpy(data, other.data);      // æ·±æ‹·è´
        }
        return *this;
    }

    void print() const { cout << data << endl; }
};

int main() {
    MyString a("hello");
    MyString b("world");

    b = a;          // è§¦å‘ operator=
    a.print();      // hello
    b.print();      // hello
}
```

ğŸ‘‰ **è¦ç‚¹**ï¼š

- åˆ¤æ–­ `this != &rhs`ï¼Œé˜²æ­¢ `a = a;` è‡ªèµ‹å€¼å¯¼è‡´æå‰é‡Šæ”¾å†…å­˜ã€‚
- è¿”å› `*this` çš„å¼•ç”¨ï¼Œæ”¯æŒé“¾å¼èµ‹å€¼ï¼š`a = b = c;`ã€‚

------

## 3. å°æ€»ç»“

- **é‡è½½ `[]`**ï¼š
  - å¸¸ç”¨äºè‡ªå®šä¹‰å®¹å™¨ç±»ï¼Œå¿…é¡»è¿”å›å¼•ç”¨æ‰èƒ½ä¿®æ”¹ã€‚
  - å»ºè®®æä¾› `const` ç‰ˆæœ¬ã€‚
- **é‡è½½ `=`**ï¼š
  - å¦‚æœç±»ä¸­æœ‰èµ„æºï¼ˆæŒ‡é’ˆã€æ–‡ä»¶å¥æŸ„ã€socket ç­‰ï¼‰ï¼Œä¸€å®šè¦è‡ªå·±å®ç°æ·±æ‹·è´ã€‚
  - éµå¾ª **Rule of Three / Rule of Five**ï¼ˆå†™äº†ææ„å‡½æ•°ï¼Œå°±è¦è€ƒè™‘å†™æ‹·è´æ„é€ å’Œèµ‹å€¼è¿ç®—ç¬¦ï¼‰ã€‚

------

è¦ä¸è¦æˆ‘å¸®ä½ å†™ä¸€ä¸ªã€Œæ•°ç»„ç±»ã€çš„å®Œæ•´ä¾‹å­ï¼Œé‡Œé¢åŒæ—¶å®ç°äº† `operator[]` å’Œ `operator=`ï¼Œè¿™æ ·ä½ èƒ½çœ‹åˆ°å®ƒä»¬ç»“åˆä½¿ç”¨çš„æ•ˆæœï¼Ÿ