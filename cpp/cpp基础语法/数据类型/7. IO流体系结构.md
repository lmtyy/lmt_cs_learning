C++的I/O系统基于**流（Stream）**的概念，提供了强大而灵活的输入输出功能。

---

## 1. I/O流体系结构

C++ I/O系统建立在类层次结构之上：

```
ios_base
  │
  ├── ios
  │     │
  │     ├── istream (输入流)
  │     │     ├── ifstream (文件输入)
  │     │     └── istringstream (字符串输入)
  │     │
  │     └── ostream (输出流)
  │           ├── ofstream (文件输出)
  │           └── ostringstream (字符串输出)
  │
  └── iostream (双向流)
        ├── fstream (文件流)
        └── stringstream (字符串流)
```

---

## 2. 标准流对象

C++预定义了4个标准流对象：

| 流对象 | 类型      | 用途               | 对应C中的 |
| ------ | --------- | ------------------ | --------- |
| `cin`  | `istream` | 标准输入（键盘）   | `stdin`   |
| `cout` | `ostream` | 标准输出（屏幕）   | `stdout`  |
| `cerr` | `ostream` | 标准错误（无缓冲） | `stderr`  |
| `clog` | `ostream` | 标准日志（有缓冲） | -         |

```cpp
#include <iostream>
using namespace std;

int main() {
    int number;
    cout << "请输入一个数字: ";  // 输出到屏幕
    cin >> number;              // 从键盘输入
    cout << "你输入的是: " << number << endl;
    
    cerr << "这是一个错误信息" << endl;  // 立即输出
    clog << "这是一个日志信息" << endl;  // 可能缓冲
    
    return 0;
}
```

---

## 3. 格式化输出

### 3.1 使用操纵符（Manipulators）
```cpp
#include <iostream>
#include <iomanip>  // 格式化操纵符
using namespace std;

int main() {
    int num = 255;
    double pi = 3.1415926535;
    
    // 进制转换
    cout << "十进制: " << num << endl;
    cout << "十六进制: " << hex << num << endl;
    cout << "八进制: " << oct << num << endl;
    cout << dec;  // 恢复十进制
    
    // 浮点数格式化
    cout << "默认: " << pi << endl;
    cout << "固定小数: " << fixed << pi << endl;
    cout << "科学计数: " << scientific << pi << endl;
    
    // 精度控制
    cout << "精度2位: " << setprecision(2) << pi << endl;
    cout << "精度5位: " << setprecision(5) << pi << endl;
    
    // 宽度和对齐
    cout << setw(10) << num << endl;      // 宽度10，右对齐
    cout << setw(10) << left << num << endl; // 左对齐
    cout << setw(10) << right << num << endl; // 右对齐
    
    // 填充字符
    cout << setw(10) << setfill('*') << num << endl;
    
    // 布尔值格式化
    bool flag = true;
    cout << "默认: " << flag << endl;          // 输出1
    cout << boolalpha << flag << endl;         // 输出true
    cout << noboolalpha << flag << endl;       // 恢复数字输出
    
    return 0;
}
```

### 3.2 完整的格式化示例
```cpp
#include <iostream>
#include <iomanip>
using namespace std;

void format_table() {
    cout << "┌────────────┬────────────┬────────────┐" << endl;
    cout << "│ " << setw(10) << left << "Name" 
         << " │ " << setw(10) << "Age"
         << " │ " << setw(10) << "Salary"
         << " │" << endl;
    cout << "├────────────┼────────────┼────────────┤" << endl;
    
    cout << "│ " << setw(10) << "John" 
         << " │ " << setw(10) << 25
         << " │ " << setw(10) << fixed << setprecision(2) << 50000.50
         << " │" << endl;
         
    cout << "│ " << setw(10) << "Alice" 
         << " │ " << setw(10) << 30
         << " │ " << setw(10) << 75000.75
         << " │" << endl;
         
    cout << "└────────────┴────────────┴────────────┘" << endl;
}

int main() {
    format_table();
    return 0;
}
```

---

## 4. 输入处理

### 4.1 基本输入方法
```cpp
#include <iostream>
#include <string>
using namespace std;

int main() {
    int age;
    double salary;
    string name;
    
    // 单个变量输入
    cout << "请输入年龄: ";
    cin >> age;
    
    cout << "请输入薪水: ";
    cin >> salary;
    
    // 字符串输入（遇到空格停止）
    cout << "请输入姓名: ";
    cin >> name;
    
    cout << "姓名: " << name << ", 年龄: " << age 
         << ", 薪水: " << salary << endl;
    
    return 0;
}
```

### 4.2 处理包含空格的字符串
```cpp
#include <iostream>
#include <string>
using namespace std;

int main() {
    string full_name;
    string address;
    
    // 清除输入缓冲区
    cin.ignore(1000, '\n');  // 忽略最多1000字符直到换行
    
    cout << "请输入全名: ";
    getline(cin, full_name);  // 读取整行（包括空格）
    
    cout << "请输入地址: ";
    getline(cin, address);
    
    cout << "全名: " << full_name << endl;
    cout << "地址: " << address << endl;
    
    return 0;
}
```

### 4.3 输入验证和错误处理
```cpp
#include <iostream>
#include <limits>
using namespace std;

int get_valid_int(const string& prompt) {
    int value;
    while (true) {
        cout << prompt;
        cin >> value;
        
        if (cin.fail()) {  // 检查输入是否失败
            cin.clear();  // 清除错误状态
            cin.ignore(numeric_limits<streamsize>::max(), '\n'); // 清空缓冲区
            cout << "输入错误，请重新输入数字！" << endl;
        } else {
            cin.ignore(numeric_limits<streamsize>::max(), '\n'); // 清空多余字符
            return value;
        }
    }
}

int main() {
    int age = get_valid_int("请输入年龄: ");
    cout << "有效的年龄: " << age << endl;
    
    return 0;
}
```

---

## 5. 文件I/O

### 5.1 文件读写基础
```cpp
#include <iostream>
#include <fstream>
#include <string>
using namespace std;

void file_io_example() {
    // 写入文件
    ofstream outfile("example.txt");
    if (outfile.is_open()) {
        outfile << "Hello File I/O!" << endl;
        outfile << "这是第二行" << endl;
        outfile << 42 << " " << 3.14 << endl;
        outfile.close();
        cout << "文件写入成功" << endl;
    } else {
        cerr << "无法打开文件写入" << endl;
    }
    
    // 读取文件
    ifstream infile("example.txt");
    if (infile.is_open()) {
        string line;
        cout << "文件内容:" << endl;
        while (getline(infile, line)) {
            cout << line << endl;
        }
        infile.close();
    } else {
        cerr << "无法打开文件读取" << endl;
    }
}

int main() {
    file_io_example();
    return 0;
}
```

### 5.2 二进制文件操作
```cpp
#include <iostream>
#include <fstream>
using namespace std;

struct Person {
    char name[50];
    int age;
    double salary;
};

void binary_file_example() {
    // 写入二进制文件
    Person p = {"张三", 25, 50000.50};
    
    ofstream outfile("person.dat", ios::binary);
    if (outfile) {
        outfile.write(reinterpret_cast<char*>(&p), sizeof(Person));
        outfile.close();
    }
    
    // 读取二进制文件
    Person p2;
    ifstream infile("person.dat", ios::binary);
    if (infile) {
        infile.read(reinterpret_cast<char*>(&p2), sizeof(Person));
        infile.close();
        
        cout << "姓名: " << p2.name << endl;
        cout << "年龄: " << p2.age << endl;
        cout << "薪水: " << p2.salary << endl;
    }
}

int main() {
    binary_file_example();
    return 0;
}
```

---

## 6. 字符串流

### 6.1 字符串流的使用
```cpp
#include <iostream>
#include <sstream>
#include <string>
using namespace std;

void string_stream_example() {
    // 将数据写入字符串
    ostringstream oss;
    oss << "姓名: 李四" << endl;
    oss << "年龄: " << 30 << endl;
    oss << "薪水: " << fixed << setprecision(2) << 80000.50;
    
    string result = oss.str();
    cout << "字符串流内容:" << endl << result << endl;
    
    // 从字符串读取数据
    string data = "100 3.14 Hello";
    istringstream iss(data);
    
    int num;
    double value;
    string text;
    
    iss >> num >> value >> text;
    cout << "解析结果: " << num << ", " << value << ", " << text << endl;
    
    // 类型转换
    string str_num = "12345";
    istringstream converter(str_num);
    int converted_num;
    converter >> converted_num;
    cout << "转换后的数字: " << converted_num + 1 << endl;
}

int main() {
    string_stream_example();
    return 0;
}
```

---

## 7. 高级I/O特性

### 7.1 流状态管理
```cpp
#include <iostream>
#include <fstream>
using namespace std;

void stream_state_management() {
    ifstream file("nonexistent.txt");
    
    // 检查流状态
    if (file.fail()) {
        cerr << "文件打开失败" << endl;
    }
    
    if (file.bad()) {
        cerr << "发生严重错误" << endl;
    }
    
    if (file.eof()) {
        cout << "到达文件末尾" << endl;
    }
    
    if (file.good()) {
        cout << "流状态正常" << endl;
    }
    
    // 重置流状态
    file.clear();
}

int main() {
    stream_state_management();
    return 0;
}
```

### 7.2 自定义输出格式
```cpp
#include <iostream>
#include <iomanip>
using namespace std;

// 自定义货币格式
ostream& currency(ostream& os) {
    os << fixed << setprecision(2);
    os << '$';
    return os;
}

// 自定义时间格式
ostream& time_format(ostream& os) {
    os << setfill('0');
    return os;
}

int main() {
    double amount = 1234.567;
    int hours = 9, minutes = 5, seconds = 3;
    
    cout << currency << amount << endl;  // 输出: $1234.57
    cout << time_format << setw(2) << hours << ":" 
         << setw(2) << minutes << ":" 
         << setw(2) << seconds << endl;  // 输出: 09:05:03
    
    return 0;
}
```

---

## 8. 实用工具函数

### 8.1 通用的输入函数
```cpp
#include <iostream>
#include <string>
#include <limits>
using namespace std;

template<typename T>
T get_input(const string& prompt) {
    T value;
    while (true) {
        cout << prompt;
        cin >> value;
        
        if (cin.fail()) {
            cin.clear();
            cin.ignore(numeric_limits<streamsize>::max(), '\n');
            cout << "输入错误，请重新输入！" << endl;
        } else {
            cin.ignore(numeric_limits<streamsize>::max(), '\n');
            return value;
        }
    }
}

string get_line_input(const string& prompt) {
    string value;
    cout << prompt;
    getline(cin, value);
    return value;
}

int main() {
    int age = get_input<int>("请输入年龄: ");
    double salary = get_input<double>("请输入薪水: ");
    string name = get_line_input("请输入姓名: ");
    
    cout << "姓名: " << name << ", 年龄: " << age 
         << ", 薪水: " << salary << endl;
    
    return 0;
}
```

### 8.2 文件工具函数
```cpp
#include <iostream>
#include <fstream>
#include <vector>
#include <string>
using namespace std;

vector<string> read_file_lines(const string& filename) {
    vector<string> lines;
    ifstream file(filename);
    
    if (file.is_open()) {
        string line;
        while (getline(file, line)) {
            lines.push_back(line);
        }
        file.close();
    }
    
    return lines;
}

bool write_file_lines(const string& filename, const vector<string>& lines) {
    ofstream file(filename);
    
    if (file.is_open()) {
        for (const auto& line : lines) {
            file << line << endl;
        }
        file.close();
        return true;
    }
    
    return false;
}

int main() {
    // 写入文件
    vector<string> content = {"第一行", "第二行", "第三行"};
    write_file_lines("test.txt", content);
    
    // 读取文件
    vector<string> lines = read_file_lines("test.txt");
    for (const auto& line : lines) {
        cout << line << endl;
    }
    
    return 0;
}
```

---

## 9. 最佳实践和建议

### 9.1 输入输出最佳实践
```cpp
#include <iostream>
#include <iomanip>
#include <string>
using namespace std;

void io_best_practices() {
    // 1. 总是检查I/O操作是否成功
    if (!cout) {
        cerr << "输出失败" << endl;
    }
    
    // 2. 使用作用域限制格式设置
    {
        cout << fixed << setprecision(2);
        cout << 3.14159 << endl;  // 3.14
    }
    cout << 3.14159 << endl;      // 恢复默认格式
    
    // 3. 处理本地化问题
    cout.imbue(locale(""));  // 使用系统本地化设置
    
    // 4. 对于性能关键代码，避免频繁的格式切换
}

// 5. 使用RAII管理文件资源
class FileHandler {
    ofstream file;
public:
    FileHandler(const string& filename) : file(filename) {
        if (!file) throw runtime_error("无法打开文件");
    }
    ~FileHandler() { if (file.is_open()) file.close(); }
    ofstream& get() { return file; }
};

int main() {
    io_best_practices();
    return 0;
}
```

---

## 总结

C++ I/O系统的关键要点：

1. **流为基础**：基于面向对象的流概念，统一处理各种I/O
2. **丰富的格式化**：通过`<iomanip>`提供强大的格式化功能
3. **多种流类型**：控制台、文件、字符串流满足不同需求
4. **错误处理重要**：必须检查流状态以确保操作成功
5. **资源管理**：使用RAII模式管理文件等资源

