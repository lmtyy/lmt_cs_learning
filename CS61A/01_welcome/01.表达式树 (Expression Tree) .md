# 表达式树 (Expression Tree) 详解

表达式树是计算机科学中一种重要的数据结构，它以树形结构表示表达式，广泛应用于编译器设计、数学计算和数据库查询优化等领域。

## 什么是表达式树？

表达式树是一种二叉树，其中：
- 每个**叶节点**代表操作数（常数或变量）
- 每个**内部节点**代表运算符（如 +, -, *, / 等）

## 表达式树的构建

### 示例表达式
以表达式 `(5 + 3) * (10 - 2)` 为例：

```
        *
      /   \
     +     -
    / \   / \
   5  3 10  2
```

### 构建过程
1. 识别运算符优先级：乘除高于加减
2. 递归地将表达式分解为子表达式
3. 运算符作为父节点，操作数作为子节点

## 表达式树的类型

1. **二叉树表达式树**：每个运算符最多两个操作数
2. **n叉树表达式树**：运算符可以有多个操作数
3. **带括号的表达式树**：显式表示运算顺序

## 表达式树的遍历

1. **中序遍历(In-order)**：产生中缀表达式（原始表达式）
   - 示例：`(5 + 3) * (10 - 2)`

2. **前序遍历(Pre-order)**：产生前缀表达式（波兰表示法）
   - 示例：`* + 5 3 - 10 2`

3. **后序遍历(Post-order)**：产生后缀表达式（逆波兰表示法）
   - 示例：`5 3 + 10 2 - *`

## 表达式树的应用

1. **编译器设计**：
   - 将源代码转换为中间表示
   - 优化表达式计算

2. **数据库系统**：
   - 表示SQL查询条件
   - 查询优化和重写

3. **数学软件**：
   - 符号计算
   - 表达式化简

4. **动态代码生成**：
   - 在.NET中，Expression Trees用于动态生成代码
   - LINQ查询转换为SQL

## 表达式树的评估

可以通过递归方式评估表达式树：

```python
def evaluate(node):
    if node is leaf:
        return node.value
    left_val = evaluate(node.left)
    right_val = evaluate(node.right)
    return apply_operator(node.operator, left_val, right_val)
```

## 表达式树的变体

1. **抽象语法树(AST)**：更复杂的语法结构表示
2. **决策树**：用于分类和预测
3. **解析树**：反映语法分析过程

表达式树是连接表达式表示和计算的重要桥梁，理解它有助于深入理解计算机如何处理和优化表达式计算。