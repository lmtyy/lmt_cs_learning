# Python 函数的文档和文档测试功能

Python 提供了强大的文档和文档测试功能，可以帮助开发者编写清晰的文档并确保文档中的示例代码能够正确运行。

## 1. 函数文档 (Docstrings)

Python 使用 **docstrings** (文档字符串) 来为函数、模块和类提供文档说明。

### 基本用法

```python
def add(a, b):
    """返回两个数字的和
    
    Args:
        a (int/float): 第一个数字
        b (int/float): 第二个数字
    
    Returns:
        int/float: 两个数字的和
    """
    return a + b
```

### 文档字符串的常见格式

1. **Google 风格**:
```python
def subtract(a, b):
    """计算两个数的差。
    
    Args:
        a: 被减数
        b: 减数
    
    Returns:
        两数的差值
    
    Raises:
        TypeError: 如果参数不是数字类型
    """
    return a - b
```

2. **NumPy/SciPy 风格**:
```python
def multiply(a, b):
    """计算两个数的乘积
    
    Parameters
    ----------
    a : int or float
        第一个乘数
    b : int or float
        第二个乘数
    
    Returns
    -------
    int or float
        两个数的乘积
    """
    return a * b
```

3. **reStructuredText 风格**:
```python
def divide(a, b):
    """计算两个数的商
    
    :param a: 被除数
    :type a: int or float
    :param b: 除数
    :type b: int or float
    :return: 两数的商
    :rtype: float
    :raises ZeroDivisionError: 当除数为0时
    """
    return a / b
```

### 访问文档字符串

```python
print(add.__doc__)  # 直接访问
help(add)           # 通过help函数查看
```

## 2. 文档测试 (Doctest)

文档测试是一种将测试用例嵌入文档字符串中的方法，可以验证文档中的示例代码是否正确。

### 基本用法

```python
def factorial(n):
    """计算n的阶乘
    
    >>> factorial(5)
    120
    >>> factorial(1)
    1
    >>> factorial(0)
    1
    >>> factorial(-1)
    Traceback (most recent call last):
        ...
    ValueError: n must be >= 0
    """
    if n < 0:
        raise ValueError("n must be >= 0")
    return 1 if n <= 1 else n * factorial(n-1)
```

### 运行文档测试

1. **命令行运行**:
```bash
python -m doctest -v your_module.py
```

2. **在代码中运行**:
```python
if __name__ == "__main__":
    import doctest
    doctest.testmod()
```

### 文档测试的高级特性

1. **忽略输出中的特定部分**:
```python
def get_random():
    """返回一个随机数
    
    >>> 0 <= get_random() < 1  # 只验证范围
    True
    """
    import random
    return random.random()
```

2. **多行测试**:
```python
def split_string(s):
    """分割字符串
    
    >>> split_string('hello world')
    ['hello', 'world']
    >>> split_string('a,b,c', sep=',')
    ['a', 'b', 'c']
    """
    return s.split()
```

3. **异常测试**:
```python
def divide(a, b):
    """除法运算
    
    >>> divide(10, 2)
    5.0
    >>> divide(10, 0)
    Traceback (most recent call last):
        ...
    ZeroDivisionError: division by zero
    """
    return a / b
```

## 3. 最佳实践

1. **为所有公共函数编写文档字符串**
2. **保持文档与代码同步更新**
3. **在文档中包含示例用法**
4. **使用文档测试验证示例代码**
5. **选择一种文档风格并保持一致性**
6. **描述函数的参数、返回值和可能抛出的异常**

## 4. 工具支持

1. **Sphinx**: 可以从文档字符串生成漂亮的HTML文档
2. **pydoc**: Python自带的文档生成工具
3. **pytest**: 可以运行文档测试
4. **IDE支持**: 大多数Python IDE可以显示文档字符串提示

通过良好的文档和文档测试实践，可以显著提高代码的可维护性和可读性，同时确保文档中的示例代码始终是正确的。